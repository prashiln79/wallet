import{$d as ct,Ab as qe,Cb as ce,Cd as z,Eb as We,Fb as _,Gb as Ge,Ib as p,Lb as Qe,Ld as it,Ob as Ye,Od as at,Pb as Ke,Pd as rt,Qb as me,Sb as He,Tc as Ze,Ub as Xe,Xd as nt,Zc as Je,Zd as st,_c as et,_d as ot,fc as fe,l as se,ud as D,vd as tt,xb as R,zb as oe}from"./chunk-AMWZB5FL.js";import{$ as Pe,$b as h,A as he,Aa as Oe,Ba as ee,C,Db as ie,Ea as Ae,Ec as Ve,F as j,G as x,H as O,Hd as ge,Id as b,J as _e,Ka as V,La as B,Ma as $,N as P,Na as Fe,Nb as ze,Q as ke,Qa as Re,Qb as q,Rb as A,Sb as I,Vc as Be,Xb as F,Xc as pe,Ya as De,Yb as Le,Zb as Me,_b as Ne,ac as S,bb as T,bc as W,bd as $e,c as Se,f as X,fa as Te,fc as ae,g as ue,ga as U,gd as ne,h as ye,hd as Q,ic as E,ja as Ee,kc as w,p as ve,pa as g,q as k,qa as Z,r as be,sa as J,u as we,ua as d,ub as m,uc as je,v,vb as te,vc as G,wc as Ue,xa as Ce,xc as re,ya as xe,z as Ie}from"./chunk-6PX2HEG6.js";import{a as y,b as N,k as c}from"./chunk-LKDXID24.js";function vt(s,a){if(s&1&&(h(0,"mat-option",17),G(1),S()),s&2){let o=a.$implicit;I("value",o),m(),re(" ",o," ")}}function bt(s,a){if(s&1){let o=ae();h(0,"mat-form-field",14)(1,"mat-select",16,0),E("selectionChange",function(t){V(o);let i=w(2);return B(i._changePageSize(t.value))}),Me(3,vt,2,2,"mat-option",17,Le),S(),h(5,"div",18),E("click",function(){V(o);let t=je(2);return B(t.open())}),S()()}if(s&2){let o=w(2);I("appearance",o._formFieldAppearance)("color",o.color),m(),I("value",o.pageSize)("disabled",o.disabled)("aria-labelledby",o._pageSizeLabelId)("panelClass",o.selectConfig.panelClass||"")("disableOptionCentering",o.selectConfig.disableOptionCentering),m(2),Ne(o._displayedPageSizeOptions)}}function wt(s,a){if(s&1&&(h(0,"div",15),G(1),S()),s&2){let o=w(2);m(),Ue(o.pageSize)}}function It(s,a){if(s&1&&(h(0,"div",3)(1,"div",13),G(2),S(),q(3,bt,6,7,"mat-form-field",14)(4,wt,2,1,"div",15),S()),s&2){let o=w();m(),A("id",o._pageSizeLabelId),m(),re(" ",o._intl.itemsPerPageLabel," "),m(),F(o._displayedPageSizeOptions.length>1?3:-1),m(),F(o._displayedPageSizeOptions.length<=1?4:-1)}}function _t(s,a){if(s&1){let o=ae();h(0,"button",19),E("click",function(){V(o);let t=w();return B(t.firstPage())}),$(),h(1,"svg",8),W(2,"path",20),S()()}if(s&2){let o=w();I("matTooltip",o._intl.firstPageLabel)("matTooltipDisabled",o._previousButtonsDisabled())("matTooltipPosition","above")("disabled",o._previousButtonsDisabled()),A("aria-label",o._intl.firstPageLabel)}}function kt(s,a){if(s&1){let o=ae();h(0,"button",21),E("click",function(){V(o);let t=w();return B(t.lastPage())}),$(),h(1,"svg",8),W(2,"path",22),S()()}if(s&2){let o=w();I("matTooltip",o._intl.lastPageLabel)("matTooltipDisabled",o._nextButtonsDisabled())("matTooltipPosition","above")("disabled",o._nextButtonsDisabled()),A("aria-label",o._intl.lastPageLabel)}}var le=(()=>{let a=class a{constructor(){this.changes=new X,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(e,t,i)=>{if(i==0||t==0)return`0 of ${i}`;i=Math.max(i,0);let r=e*t,n=r<i?Math.min(r+t,i):r+t;return`${r+1} \u2013 ${n} of ${i}`}}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Pt(s){return s||new le}var Tt={provide:le,deps:[[new Ce,new xe,le]],useFactory:Pt},Et=50;var Ct=new J("MAT_PAGINATOR_DEFAULT_OPTIONS"),xt=0,Ot=(()=>{let a=class a{get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=Math.max(e||0,0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(e){this._length=e||0,this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=Math.max(e||0,0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(e){this._pageSizeOptions=(e||[]).map(t=>Q(t,0)),this._updateDisplayedPageSizeOptions()}constructor(e,t,i){if(this._intl=e,this._changeDetectorRef=t,this._pageSizeLabelId=`mat-paginator-page-size-label-${xt++}`,this._isInitialized=!1,this._initializedStream=new ye(1),this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.hidePageSize=!1,this.showFirstLastButtons=!1,this.selectConfig={},this.disabled=!1,this.page=new De,this.initialized=this._initializedStream,this._intlChanges=e.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),i){let{pageSize:r,pageSizeOptions:n,hidePageSize:l,showFirstLastButtons:u}=i;r!=null&&(this._pageSize=r),n!=null&&(this._pageSizeOptions=n),l!=null&&(this.hidePageSize=l),u!=null&&(this.showFirstLastButtons=u)}this._formFieldAppearance=(i==null?void 0:i.formFieldAppearance)||"outline"}ngOnInit(){this._isInitialized=!0,this._updateDisplayedPageSizeOptions(),this._initializedStream.next()}ngOnDestroy(){this._initializedStream.complete(),this._intlChanges.unsubscribe()}nextPage(){if(!this.hasNextPage())return;let e=this.pageIndex;this.pageIndex=this.pageIndex+1,this._emitPageEvent(e)}previousPage(){if(!this.hasPreviousPage())return;let e=this.pageIndex;this.pageIndex=this.pageIndex-1,this._emitPageEvent(e)}firstPage(){if(!this.hasPreviousPage())return;let e=this.pageIndex;this.pageIndex=0,this._emitPageEvent(e)}lastPage(){if(!this.hasNextPage())return;let e=this.pageIndex;this.pageIndex=this.getNumberOfPages()-1,this._emitPageEvent(e)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let e=this.getNumberOfPages()-1;return this.pageIndex<e&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(e){let t=this.pageIndex*this.pageSize,i=this.pageIndex;this.pageIndex=Math.floor(t/e)||0,this.pageSize=e,this._emitPageEvent(i)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._isInitialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:Et),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((e,t)=>e-t),this._changeDetectorRef.markForCheck())}_emitPageEvent(e){this.page.emit({previousPageIndex:e,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}};a.\u0275fac=function(t){return new(t||a)(te(le),te($e),te(Ct,8))},a.\u0275cmp=Oe({type:a,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[2,"pageIndex","pageIndex",Q],length:[2,"length","length",Q],pageSize:[2,"pageSize","pageSize",Q],pageSizeOptions:"pageSizeOptions",hidePageSize:[2,"hidePageSize","hidePageSize",ne],showFirstLastButtons:[2,"showFirstLastButtons","showFirstLastButtons",ne],selectConfig:"selectConfig",disabled:[2,"disabled","disabled",ne]},outputs:{page:"page"},exportAs:["matPaginator"],standalone:!0,features:[ze,Ve],decls:14,vars:14,consts:[["selectRef",""],[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-previous",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-next",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],[1,"mat-mdc-paginator-page-size-label"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],[1,"mat-mdc-paginator-page-size-value"],["hideSingleSelectionIndicator","",3,"selectionChange","value","disabled","aria-labelledby","panelClass","disableOptionCentering"],[3,"value"],[1,"mat-mdc-paginator-touch-target",3,"click"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(t,i){t&1&&(h(0,"div",1)(1,"div",2),q(2,It,5,4,"div",3),h(3,"div",4)(4,"div",5),G(5),S(),q(6,_t,3,5,"button",6),h(7,"button",7),E("click",function(){return i.previousPage()}),$(),h(8,"svg",8),W(9,"path",9),S()(),Fe(),h(10,"button",10),E("click",function(){return i.nextPage()}),$(),h(11,"svg",8),W(12,"path",11),S()(),q(13,kt,3,5,"button",12),S()()()),t&2&&(m(2),F(i.hidePageSize?-1:2),m(3),re(" ",i._intl.getRangeLabel(i.pageIndex,i.pageSize,i.length)," "),m(),F(i.showFirstLastButtons?6:-1),m(),I("matTooltip",i._intl.previousPageLabel)("matTooltipDisabled",i._previousButtonsDisabled())("matTooltipPosition","above")("disabled",i._previousButtonsDisabled()),A("aria-label",i._intl.previousPageLabel),m(3),I("matTooltip",i._intl.nextPageLabel)("matTooltipDisabled",i._nextButtonsDisabled())("matTooltipPosition","above")("disabled",i._nextButtonsDisabled()),A("aria-label",i._intl.nextPageLabel),m(3),F(i.showFirstLastButtons?13:-1))},dependencies:[nt,st,Ze,Je,at],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color, var(--mat-app-on-surface));background-color:var(--mat-paginator-container-background-color, var(--mat-app-surface));font-family:var(--mat-paginator-container-text-font, var(--mat-app-body-small-font));line-height:var(--mat-paginator-container-text-line-height, var(--mat-app-body-small-line-height));font-size:var(--mat-paginator-container-text-size, var(--mat-app-body-small-size));font-weight:var(--mat-paginator-container-text-weight, var(--mat-app-body-small-weight));letter-spacing:var(--mat-paginator-container-text-tracking, var(--mat-app-body-small-tracking));--mat-form-field-container-height:var(--mat-paginator-form-field-container-height);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size, var(--mat-app-body-small-size))}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color, var(--mat-app-on-surface-variant))}.mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color)}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}.cdk-high-contrast-active .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon,.cdk-high-contrast-active .mat-mdc-paginator-icon{fill:currentColor;fill:CanvasText}.cdk-high-contrast-active .mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}.mat-mdc-paginator-touch-target{display:var(--mat-paginator-touch-target-display);position:absolute;top:50%;left:50%;width:84px;height:48px;background-color:rgba(0,0,0,0);transform:translate(-50%, -50%);cursor:pointer}"],encapsulation:2,changeDetection:0});let s=a;return s})(),ei=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=ee({type:a}),a.\u0275inj=Z({providers:[Tt],imports:[et,ot,rt,Ot]});let s=a;return s})();var K="Service workers are disabled or not supported by this browser";function At(s){return he(()=>be(new Error(s)))}var M=class{constructor(a){if(this.serviceWorker=a,!a)this.worker=this.events=this.registration=At(K);else{let e=C(a,"controllerchange").pipe(v(()=>a.controller)),t=he(()=>k(a.controller)),i=Ie(t,e);this.worker=i.pipe(O(f=>!!f)),this.registration=this.worker.pipe(U(()=>a.getRegistration()));let u=C(a,"message").pipe(v(f=>f.data)).pipe(O(f=>f&&f.type)).pipe(Pe());u.connect(),this.events=u}}postMessage(a,o){return this.worker.pipe(P(1),Ee(e=>{e.postMessage(y({action:a},o))})).toPromise().then(()=>{})}postMessageWithOperation(a,o,e){let t=this.waitForOperationCompleted(e),i=this.postMessage(a,o);return Promise.all([i,t]).then(([,r])=>r)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(a){let o;return typeof a=="string"?o=e=>e.type===a:o=e=>a.includes(e.type),this.events.pipe(O(o))}nextEventOfType(a){return this.eventsOfType(a).pipe(P(1))}waitForOperationCompleted(a){return this.eventsOfType("OPERATION_COMPLETED").pipe(O(o=>o.nonce===a),P(1),v(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},ht=(()=>{let a=class a{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new X,!e.isEnabled){this.messages=x,this.notificationClicks=x,this.subscription=x;return}this.messages=this.sw.eventsOfType("PUSH").pipe(v(i=>i.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(v(i=>i.data)),this.pushManager=this.sw.registration.pipe(v(i=>i.pushManager));let t=this.pushManager.pipe(U(i=>i.getSubscription()));this.subscription=j(t,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(K));let t={userVisibleOnly:!0},i=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),r=new Uint8Array(new ArrayBuffer(i.length));for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.applicationServerKey=r,this.pushManager.pipe(U(n=>n.subscribe(t)),P(1)).toPromise().then(n=>(this.subscriptionChanges.next(n),n))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=t=>{if(t===null)throw new Error("Not subscribed to push notifications.");return t.unsubscribe().then(i=>{if(!i)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(P(1),U(e)).toPromise()}decodeBase64(e){return atob(e)}};a.\u0275fac=function(t){return new(t||a)(d(M))},a.\u0275prov=g({token:a,factory:a.\u0275fac});let s=a;return s})(),de=(()=>{let a=class a{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=x,this.unrecoverable=x;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}};a.\u0275fac=function(t){return new(t||a)(d(M))},a.\u0275prov=g({token:a,factory:a.\u0275fac});let s=a;return s})();var lt=new J("");function Ft(s,a,o,e){return()=>{if(!(ge(e)&&"serviceWorker"in navigator&&o.enabled!==!1))return;let t=s.get(ie),i=s.get(pe);t.runOutsideAngular(()=>{let n=navigator.serviceWorker,l=()=>{var u;return(u=n.controller)==null?void 0:u.postMessage({action:"INITIALIZE"})};n.addEventListener("controllerchange",l),i.onDestroy(()=>{n.removeEventListener("controllerchange",l)})});let r;if(typeof o.registrationStrategy=="function")r=o.registrationStrategy();else{let[n,...l]=(o.registrationStrategy||"registerWhenStable:30000").split(":");switch(n){case"registerImmediately":r=k(null);break;case"registerWithDelay":r=dt(+l[0]||0);break;case"registerWhenStable":r=l[0]?j(ut(s),dt(+l[0])):ut(s);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${o.registrationStrategy}`)}}t.runOutsideAngular(()=>r.pipe(P(1)).subscribe(()=>navigator.serviceWorker.register(a,{scope:o.scope}).catch(n=>console.error("Service worker registration failed with:",n))))}}function dt(s){return k(null).pipe(ke(s))}function ut(s){return s.get(pe).isStable.pipe(O(o=>o))}function Rt(s,a){return new M(ge(a)&&s.enabled!==!1?navigator.serviceWorker:void 0)}var Y=class{};function Dt(s,a={}){return Ae([ht,de,{provide:lt,useValue:s},{provide:Y,useValue:a},{provide:M,useFactory:Rt,deps:[Y,T]},{provide:Be,useFactory:Ft,deps:[Re,lt,Y,T],multi:!0}])}var ci=(()=>{let a=class a{static register(e,t={}){return{ngModule:a,providers:[Dt(e,t)]}}};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=ee({type:a}),a.\u0275inj=Z({providers:[ht,de]});let s=a;return s})();var ft=(()=>{let a=class a{constructor(e,t,i,r,n,l,u,f,H){this.firestore=e,this.auth=t,this.ngZone=i,this.validationService=r,this.swUpdate=n,this.userService=l,this.dateService=u,this.notificationService=f,this.platformId=H,this.DEFAULT_EXPIRY=24*60*60*1e3,this.DEFAULT_MAX_SIZE=50*1024*1024,this.HIGH_PRIORITY_EXPIRY=7*24*60*60*1e3,this.LOW_PRIORITY_EXPIRY=60*60*1e3,this.networkStatusSubject=new ue({online:!1}),this.syncStatusSubject=new ue({isOnline:navigator.onLine,pendingItems:0,lastSyncTime:null,isSyncing:!1,failedItems:0,invalidItems:0}),this.networkStatus$=this.networkStatusSubject.asObservable(),this.isOnline$=this.networkStatus$.pipe(v(yt=>yt.online)),this.serviceWorkerRegistration=null,this.syncQueue=[],b(this.platformId)||(this.networkStatusSubject.next({online:navigator.onLine}),this.initializeServices())}initializeServices(){return c(this,null,function*(){yield Promise.all([this.initializeNetworkMonitoring(),this.initializeServiceWorkerUpdates(),this.initializeBackgroundSync(),this.loadSyncQueue()])})}initializeNetworkMonitoring(){if(b(this.platformId))return;let e=C(window,"online").pipe(v(()=>!0)),t=C(window,"offline").pipe(v(()=>!1));if(j(e,t).pipe(Te(navigator.onLine)).subscribe(i=>{this.updateNetworkStatus({online:i}),this.handleNetworkChange(i)}),"connection"in navigator){let i=navigator.connection;i&&i.addEventListener("change",()=>{this.updateNetworkStatus({online:navigator.onLine,connectionType:i.effectiveType,effectiveType:i.effectiveType,downlink:i.downlink,rtt:i.rtt})})}}initializeServiceWorkerUpdates(){if(this.swUpdate.isEnabled){let e=this.isMobileDevice()?fe.PWA.MOBILE_UPDATE_INTERVAL:fe.PWA.DESKTOP_UPDATE_INTERVAL;setInterval(()=>{this.swUpdate.checkForUpdate()},e),this.swUpdate.versionUpdates.subscribe(t=>{console.log("Service worker update event:",t),t.type==="VERSION_READY"?(console.log("New version available, activating silently:",t),this.activateUpdateSilently()):t.type==="VERSION_INSTALLATION_FAILED"&&(console.error("Service worker installation failed:",t),this.handleUpdateFailure())})}}initializeBackgroundSync(){return c(this,null,function*(){try{if(!("serviceWorker"in navigator)||!("sync"in window)){console.warn("Background Sync API not supported");return}let e=yield navigator.serviceWorker.getRegistrations();if(this.serviceWorkerRegistration=e.find(t=>t.scope.includes("/")||t.scope.includes("/wallet/"))||null,!this.serviceWorkerRegistration){console.warn("Service worker not registered for background sync");return}console.log("Background sync initialized successfully"),this.updateSyncStatus({isOnline:navigator.onLine})}catch(e){console.error("Failed to initialize background sync:",e)}})}handleNetworkChange(e){e?(this.showOnlineNotification(),this.processSyncQueue()):this.showOfflineNotification()}showOnlineNotification(){console.log("You are back online!","Your data will sync automatically.")}showOfflineNotification(){console.log("You are offline","Changes will be saved locally and synced when you reconnect.")}activateUpdateSilently(){this.swUpdate.activateUpdate().then(()=>{console.log("Update activated successfully"),window.location.reload()}).catch(e=>{console.error("Failed to activate update:",e)})}handleUpdateFailure(){console.error("Service worker update failed")}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}get syncStatus$(){return this.syncStatusSubject.asObservable()}get syncStatus(){return this.syncStatusSubject.value}registerSyncItem(e){return c(this,null,function*(){try{let t=this.validateSyncItem(e);if(!t.isValid)return console.error("Invalid sync item data:",e.id,t.errors),this.updateSyncStatus({invalidItems:this.syncStatus.invalidItems+1}),{success:!1,errors:t.errors};let i=N(y({},e),{timestamp:Date.now(),retryCount:0,maxRetries:e.maxRetries||3});return this.syncQueue.push(i),yield this.saveSyncQueue(),this.updateSyncStatus({pendingItems:this.syncStatus.pendingItems+1}),navigator.onLine&&(yield this.processSyncQueue()),console.log("Sync item registered:",i.id),{success:!0}}catch(t){return console.error("Failed to register sync item:",t),{success:!1,errors:[t instanceof Error?t.message:"Failed to register sync item"]}}})}processSyncQueue(){return c(this,null,function*(){if(this.syncQueue.length===0)return;this.updateSyncStatus({isSyncing:!0});let e=Xe(this.firestore),t=[],i=[];for(let r of this.syncQueue)try{let n=this.getCurrentUserId();if(!n)continue;switch(r.type){case"transaction":yield this.processTransactionSync(r,e,n);break;case"budget":yield this.processBudgetSync(r,e,n);break;case"account":yield this.processAccountSync(r,e,n);break;case"goal":yield this.processGoalSync(r,e,n);break}t.push(r.id)}catch(n){console.error(`Failed to process sync item ${r.id}:`,n),r.retryCount++,r.retryCount>=(r.maxRetries||3)&&i.push(r.id)}if(t.length>0)try{yield e.commit(),this.syncQueue=this.syncQueue.filter(r=>!t.includes(r.id)),yield this.saveSyncQueue(),this.updateSyncStatus({lastSyncTime:Date.now(),pendingItems:this.syncQueue.length,failedItems:i.length,isSyncing:!1}),console.log(`\u2705 Processed ${t.length} sync items`)}catch(r){console.error("Failed to commit sync operations:",r),this.updateSyncStatus({isSyncing:!1})}else this.updateSyncStatus({isSyncing:!1})})}processTransactionSync(e,t,i){return c(this,null,function*(){let r=_(this.firestore,`users/${i}/transactions`);switch(e.operation){case"create":let n=p(r);t.set(n,e.data);break;case"update":let l=p(this.firestore,`users/${i}/transactions/${e.data.id}`);t.update(l,e.data);break;case"delete":let u=p(this.firestore,`users/${i}/transactions/${e.data.id}`);t.delete(u);break}})}processBudgetSync(e,t,i){return c(this,null,function*(){let r=_(this.firestore,`users/${i}/budgets`);switch(e.operation){case"create":let n=p(r);t.set(n,e.data);break;case"update":let l=p(this.firestore,`users/${i}/budgets/${e.data.id}`);t.update(l,e.data);break;case"delete":let u=p(this.firestore,`users/${i}/budgets/${e.data.id}`);t.delete(u);break}})}processAccountSync(e,t,i){return c(this,null,function*(){let r=_(this.firestore,`users/${i}/accounts`);switch(e.operation){case"create":let n=p(r);t.set(n,e.data);break;case"update":let l=p(this.firestore,`users/${i}/accounts/${e.data.id}`);t.update(l,e.data);break;case"delete":let u=p(this.firestore,`users/${i}/accounts/${e.data.id}`);t.delete(u);break}})}processGoalSync(e,t,i){return c(this,null,function*(){let r=_(this.firestore,`users/${i}/goals`);switch(e.operation){case"create":let n=p(r);t.set(n,e.data);break;case"update":let l=p(this.firestore,`users/${i}/goals/${e.data.id}`);t.update(l,e.data);break;case"delete":let u=p(this.firestore,`users/${i}/goals/${e.data.id}`);t.delete(u);break}})}validateSyncItem(e){let t=[];if(!e.id||!e.type||!e.data)return t.push("Missing required fields: id, type, or data"),{isValid:!1,errors:t};switch(e.type){case"transaction":let i=this.validationService.validateTransactionData(e.data);i.isValid||t.push(...i.errors);break;case"budget":let r=this.validationService.validateCommonData(e.data);r.isValid||t.push(...r.errors);break;case"account":let n=this.validationService.validateCommonData(e.data);n.isValid||t.push(...n.errors);break;case"goal":let l=this.validationService.validateCommonData(e.data);l.isValid||t.push(...l.errors);break}return{isValid:t.length===0,errors:t}}triggerBackgroundSync(e){return c(this,null,function*(){if(!this.serviceWorkerRegistration){console.warn("Service worker not available for background sync");return}try{this.updateSyncStatus({isSyncing:!0});let t=e||"sync-transactions";"sync"in this.serviceWorkerRegistration?(yield this.serviceWorkerRegistration.sync.register(t),console.log("Background sync triggered:",t)):console.warn("Background Sync is not supported in this browser."),this.updateSyncStatus({lastSyncTime:Date.now(),isSyncing:!1})}catch(t){console.error("Failed to trigger background sync:",t),this.updateSyncStatus({isSyncing:!1})}})}manualSync(){return c(this,null,function*(){console.log("Manual sync triggered"),yield this.processSyncQueue()})}getSyncStats(){return c(this,null,function*(){let e=this.syncQueue.length+this.syncStatus.failedItems+this.syncStatus.invalidItems,t=e>0?this.syncQueue.length/e*100:0;return{totalPending:this.syncQueue.length,totalFailed:this.syncStatus.failedItems,totalInvalid:this.syncStatus.invalidItems,lastSyncTime:this.syncStatus.lastSyncTime,syncSuccessRate:t}})}clearCompletedItems(){return c(this,null,function*(){try{this.updateSyncStatus({pendingItems:this.syncQueue.length,failedItems:0,invalidItems:0})}catch(e){console.error("Failed to clear completed items:",e)}})}cacheData(r,n){return c(this,arguments,function*(e,t,i={}){if(!b(this.platformId))try{let l={key:e,data:t,timestamp:Date.now(),expiry:i.expiry||this.getDefaultExpiry(i.priority),size:this.calculateSize(t),priority:i.priority||"normal"};yield this.storeInCacheStorage(e,l),yield this.storeInLocalStorage(e,l),yield this.cleanupCache()}catch(l){console.error("Failed to cache data:",l)}})}getCachedData(e){return c(this,null,function*(){if(b(this.platformId))return null;try{let t=yield this.getFromCacheStorage(e);return t||(t=yield this.getFromLocalStorage(e)),t?this.isExpired(t)?(yield this.removeCachedData(e),null):t.data:null}catch(t){return console.error("Failed to get cached data:",t),null}})}removeCachedData(e){return c(this,null,function*(){if(!b(this.platformId))try{yield Promise.all([this.removeFromCacheStorage(e),this.removeFromLocalStorage(e)])}catch(t){console.error("Failed to remove cached data:",t)}})}clearCache(){return c(this,null,function*(){if(!b(this.platformId))try{yield Promise.all([this.clearCacheStorage(),this.clearLocalStorage()])}catch(e){console.error("Failed to clear cache:",e)}})}getCacheStats(){return c(this,null,function*(){if(b(this.platformId))return{totalItems:0,totalSize:0,expiredItems:0,cacheStorageSize:0,localStorageSize:0};try{let[e,t]=yield Promise.all([this.getAllFromCacheStorage(),this.getAllFromLocalStorage()]),i=[...e,...t],r=this.deduplicateItems(i),n=r.filter(u=>this.isExpired(u)),l=r.reduce((u,f)=>u+f.size,0);return{totalItems:r.length,totalSize:l,expiredItems:n.length,cacheStorageSize:e.length,localStorageSize:t.length}}catch(e){return console.error("Failed to get cache stats:",e),{totalItems:0,totalSize:0,expiredItems:0,cacheStorageSize:0,localStorageSize:0}}})}getCurrentNetworkStatus(){return this.networkStatusSubject.value}isCurrentlyOnline(){return this.networkStatusSubject.value.online}shouldWorkOffline(){try{let t=oe().currentUser;return!t||!localStorage.getItem(`user-data-${t.uid}`)?!1:!!(localStorage.getItem("app-cache-version")||localStorage.getItem("transactions-cache")||localStorage.getItem("categories-cache"))}catch(e){return console.error("Error checking offline capability:",e),!1}}getConnectionQuality(){let e=this.networkStatusSubject.value;return e.online?e.effectiveType==="4g"?"excellent":e.effectiveType==="3g"?"good":e.effectiveType==="2g"?"poor":"unknown":"offline"}requestNotificationPermission(){return"Notification"in window?Notification.requestPermission():Promise.resolve("denied")}updateNetworkStatus(e){let t=this.networkStatusSubject.value,i=y(y({},t),e);this.networkStatusSubject.next(i)}updateSyncStatus(e){let t=this.syncStatusSubject.value,i=y(y({},t),e);this.syncStatusSubject.next(i)}getCurrentUserId(){var e;return((e=this.auth.currentUser)==null?void 0:e.uid)||null}loadSyncQueue(){return c(this,null,function*(){try{let e=yield this.getCachedData("sync-queue");e&&Array.isArray(e)?(this.syncQueue=e,this.updateSyncStatus({pendingItems:this.syncQueue.length})):(this.syncQueue=[],this.updateSyncStatus({pendingItems:0}))}catch(e){console.error("Failed to load sync queue:",e),this.syncQueue=[],this.updateSyncStatus({pendingItems:0})}})}saveSyncQueue(){return c(this,null,function*(){try{yield this.cacheData("sync-queue",this.syncQueue)}catch(e){console.error("Failed to save sync queue:",e)}})}getDefaultExpiry(e){switch(e){case"high":return this.HIGH_PRIORITY_EXPIRY;case"low":return this.LOW_PRIORITY_EXPIRY;default:return this.DEFAULT_EXPIRY}}calculateSize(e){try{let t=JSON.stringify(e);return new Blob([t]).size}catch{return 0}}isExpired(e){return e.expiry?Date.now()>e.timestamp+e.expiry:!1}cleanupCache(){return c(this,null,function*(){try{let e=yield this.getCacheStats(),t=yield this.getCacheKeys();for(let i of t)(yield this.getCachedData(i))===null&&(yield this.removeCachedData(i));if(e.totalSize>this.DEFAULT_MAX_SIZE){let r=(yield this.getAllFromCacheStorage()).filter(n=>!this.isExpired(n)).sort((n,l)=>{let u={high:3,normal:2,low:1},f=u[n.priority],H=u[l.priority];return f!==H?H-f:n.timestamp-l.timestamp});for(let n of r)if(n.priority==="low"&&(yield this.removeCachedData(n.key),(yield this.getCacheStats()).totalSize<=this.DEFAULT_MAX_SIZE*.8))break}}catch(e){console.error("Failed to cleanup cache:",e)}})}getCacheKeys(){return c(this,null,function*(){if(b(this.platformId))return[];try{let[e,t]=yield Promise.all([this.getCacheStorageKeys(),this.getLocalStorageKeys()]);return[...new Set([...e,...t])]}catch(e){return console.error("Failed to get cache keys:",e),[]}})}storeInCacheStorage(e,t){return c(this,null,function*(){if("caches"in window)try{let i=yield caches.open("money-manager-data"),r=new Response(JSON.stringify(t));yield i.put(e,r)}catch(i){console.warn("Failed to store in Cache Storage:",i)}})}storeInLocalStorage(e,t){return c(this,null,function*(){try{localStorage.setItem(e,JSON.stringify(t))}catch(i){console.warn("Failed to store in Local Storage:",i)}})}getFromCacheStorage(e){return c(this,null,function*(){if("caches"in window)try{let i=yield(yield caches.open("money-manager-data")).match(e);if(i)return yield i.json()}catch(t){console.warn("Failed to get from Cache Storage:",t)}return null})}getFromLocalStorage(e){return c(this,null,function*(){try{let t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to get from Local Storage:",t)}return null})}removeFromCacheStorage(e){return c(this,null,function*(){if("caches"in window)try{yield(yield caches.open("money-manager-data")).delete(e)}catch(t){console.warn("Failed to remove from Cache Storage:",t)}})}removeFromLocalStorage(e){return c(this,null,function*(){try{localStorage.removeItem(e)}catch(t){console.warn("Failed to remove from Local Storage:",t)}})}clearCacheStorage(){return c(this,null,function*(){if("caches"in window)try{let e=yield caches.keys();yield Promise.all(e.map(t=>caches.delete(t)))}catch(e){console.warn("Failed to clear Cache Storage:",e)}})}clearLocalStorage(){return c(this,null,function*(){try{localStorage.clear()}catch(e){console.warn("Failed to clear Local Storage:",e)}})}getAllFromCacheStorage(){return c(this,null,function*(){if("caches"in window)try{let e=yield caches.open("money-manager-data"),t=yield e.keys(),i=[];for(let r of t){let n=yield e.match(r);if(n){let l=yield n.json();i.push(l)}}return i}catch(e){console.warn("Failed to get all from Cache Storage:",e)}return[]})}getAllFromLocalStorage(){return c(this,null,function*(){try{let e=[];for(let t=0;t<localStorage.length;t++){let i=localStorage.key(t);if(i){let r=localStorage.getItem(i);if(r)try{let n=JSON.parse(r);e.push(n)}catch{}}}return e}catch(e){return console.warn("Failed to get all from Local Storage:",e),[]}})}getCacheStorageKeys(){return c(this,null,function*(){if("caches"in window)try{return(yield(yield caches.open("money-manager-data")).keys()).map(i=>i.url)}catch(e){console.warn("Failed to get Cache Storage keys:",e)}return[]})}getLocalStorageKeys(){return c(this,null,function*(){try{let e=[];for(let t=0;t<localStorage.length;t++){let i=localStorage.key(t);i&&e.push(i)}return e}catch(e){return console.warn("Failed to get Local Storage keys:",e),[]}})}deduplicateItems(e){let t=new Map;for(let i of e){let r=t.get(i.key);(!r||i.timestamp>r.timestamp)&&t.set(i.key,i)}return Array.from(t.values())}isSupported(){return"serviceWorker"in navigator&&"sync"in window}};a.\u0275fac=function(t){return new(t||a)(d(ce),d(R),d(ie),d(tt),d(de),d(z),d(it),d(D),d(T))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Ti=(()=>{let a=class a{constructor(e){this.platformId=e}isClientSide(){return!b(this.platformId)}};a.\u0275fac=function(t){return new(t||a)(d(T))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var St={SESSION_TIMEOUT:30*60*1e3,INACTIVITY_TIMEOUT:60*60*1e3,MAX_LOGIN_ATTEMPTS:5,LOCKOUT_DURATION:15*60*1e3,PASSWORD_MIN_LENGTH:8,REQUIRE_EMAIL_VERIFICATION:!0,ENABLE_RATE_LIMITING:!0,SECURE_HEADERS:!0},Fi=(()=>{let a=class a{constructor(e,t,i,r,n){this.router=e,this.userService=t,this.notificationService=i,this.loaderService=r,this.commonSyncService=n,this.sessionStartTime=new Map,this.startSessionMonitoring()}canActivate(e,t){return this.performSecurityCheck(e,t)}canActivateChild(e,t){return this.performSecurityCheck(e,t)}performSecurityCheck(e,t){this.loaderService.show();let i=oe(),r=i.currentUser;return r?(this.backgroundSecurityCheck(e,t,r),k(!0)):new Se(n=>{let l=qe(i,u=>{l(),u?(this.backgroundSecurityCheck(e,t,u),n.next(!0),this.loaderService.hide()):this.handleUnauthenticatedUser(t).then(()=>{this.loaderService.hide(),n.next(!1)})})}).pipe(we(1e4),_e(n=>(console.error("[AuthGuard] Timeout or error:",n),this.router.navigate(["/sign-in"],{queryParams:{error:"auth_timeout",redirect:t.url}}),k(!1))))}backgroundSecurityCheck(e,t,i){setTimeout(()=>c(this,null,function*(){try{if(this.sessionStartTime.has(i.uid)||this.updateSessionTimestamp(i.uid),this.isSessionExpired(i.uid)){yield this.handleSessionExpired(i,t);return}let r=!this.commonSyncService.isCurrentlyOnline(),n;if(r?(n=this.userService.getCachedUserData(i.uid),console.log("[AuthGuard] Offline mode - using cached user data:",n?"found":"not found")):n=yield this.userService.getCurrentUser(),!n)if(r){console.warn("[AuthGuard] Offline mode - no cached user data available, allowing access"),this.updateSessionTimestamp(i.uid);return}else{yield this.handleInvalidUserData(i,t);return}if(!(yield this.checkRoutePermissions(e,n,i))){yield this.handleInsufficientPermissions(n,t);return}this.updateSessionTimestamp(i.uid)}catch(r){if(console.error("[AuthGuard] Background error:",r),!this.commonSyncService.isCurrentlyOnline()){console.warn("[AuthGuard] Offline mode - error occurred, allowing access for offline use"),this.updateSessionTimestamp(i.uid);return}yield this.handleSecurityError(r,t)}finally{this.loaderService.hide()}}),0)}checkRoutePermissions(e,t,i){return c(this,null,function*(){var n;let r=e.data;return r!=null&&r.requireEmailVerification&&!i.emailVerified?(console.warn("[AuthGuard] Email not verified"),!1):((n=r==null?void 0:r.roles)==null?void 0:n.length)>0&&!r.roles.includes(t.role)?(console.warn("[AuthGuard] Insufficient role:",t.role),!1):r!=null&&r.requireTwoFactor&&!this.hasTwoFactorEnabled(t)?(console.warn("[AuthGuard] Two-factor required"),!1):!0})}isSessionExpired(e){let t=this.sessionStartTime.get(e),i=Date.now();return!!t&&i-t>St.SESSION_TIMEOUT}updateSessionTimestamp(e){this.sessionStartTime.set(e,Date.now())}handleUnauthenticatedUser(e){return c(this,null,function*(){this.router.navigate(["/sign-in"],{queryParams:{session:"expired",redirect:e.url}})})}handleSessionExpired(e,t){return c(this,null,function*(){this.sessionStartTime.delete(e.uid),this.userService.clearCachedUserData(),yield this.userService.signOut(),this.router.navigate(["/sign-in"],{queryParams:{session:"expired",redirect:t.url,reason:"timeout"}})})}handleInvalidUserData(e,t){return c(this,null,function*(){this.userService.clearCachedUserData(),yield this.userService.signOut(),this.router.navigate(["/sign-in"],{queryParams:{error:"invalid_user_data",redirect:t.url}})})}handleInsufficientPermissions(e,t){return c(this,null,function*(){this.notificationService.error("Access Denied: You do not have permission to access this page."),this.router.navigate(["/dashboard"],{queryParams:{error:"insufficient_permissions",requestedRoute:t.url}})})}handleSecurityError(e,t){return c(this,null,function*(){this.router.navigate(["/sign-in"],{queryParams:{error:"security_error",redirect:t.url,message:e.message||"Unknown error"}})})}startSessionMonitoring(){let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{this.handleInactivity()},St.INACTIVITY_TIMEOUT)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(i=>{document.addEventListener(i,t,!0)}),t()}handleInactivity(){let e=this.userService.getUser();e&&(console.log("[AuthGuard] Inactivity detected. Logging out user:",e.uid),this.userService.signOut())}hasTwoFactorEnabled(e){return!1}};a.\u0275fac=function(t){return new(t||a)(d(se),d(z),d(D),d(ct),d(ft))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Li=(()=>{let a=class a{constructor(e,t,i,r){this.auth=e,this.router=t,this.notificationService=i,this.userService=r}canActivate(e,t){return ve(this.checkAdminAccess())}checkAdminAccess(){return c(this,null,function*(){try{return(yield this.auth.currentUser)?(yield this.isUserAdmin())?!0:(this.notificationService.error("Admin access required"),this.router.navigate(["/dashboard"]),!1):(this.notificationService.error("Authentication required"),this.router.navigate(["/sign-in"]),!1)}catch(e){return console.error("Error checking admin access:",e),this.notificationService.error("Failed to verify admin access"),this.router.navigate(["/dashboard"]),!1}})}isUserAdmin(){return c(this,null,function*(){return this.userService.isAdmin})}};a.\u0275fac=function(t){return new(t||a)(d(R),d(se),d(D),d(z))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Ui=(()=>{let a=class a{constructor(e,t){this.firestore=e,this.auth=t}submitFeedback(e){return c(this,null,function*(){var t;try{let i=N(y({},e),{userId:((t=this.auth.currentUser)==null?void 0:t.uid)||"anonymous",timestamp:me(),status:"pending",userAgent:navigator.userAgent,appVersion:"1.0.0"}),r=_(this.firestore,"feedback"),n=yield We(r,i);console.log("Feedback submitted successfully:",n.id)}catch(i){throw console.error("Error submitting feedback:",i),i}})}getCategoryLabel(e){return{bug:"Bug Report",feature:"Feature Request",improvement:"Improvement Suggestion",general:"General Feedback",support:"Support Request"}[e]||e}getAllFeedback(){return c(this,null,function*(){try{let e=_(this.firestore,"feedback"),t=Ke(e,Ye("timestamp","desc")),i=yield Qe(t),r=[];return i.forEach(n=>{let l=n.data();r.push(N(y({},l),{id:n.id}))}),r}catch(e){throw console.error("Error fetching feedback:",e),e}})}updateFeedbackStatus(e,t){return c(this,null,function*(){try{let i=p(this.firestore,"feedback",e);yield He(i,{status:t,updatedAt:me()})}catch(i){throw console.error("Error updating feedback status:",i),i}})}deleteFeedback(e){return c(this,null,function*(){try{let t=p(this.firestore,"feedback",e);yield Ge(t)}catch(t){throw console.error("Error deleting feedback:",t),t}})}};a.\u0275fac=function(t){return new(t||a)(d(ce),d(R))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();export{de as a,ci as b,ft as c,Ti as d,Fi as e,Li as f,Ot as g,ei as h,Ui as i};
