import{$b as he,$d as _t,Ab as wt,Bd as Z,Cb as P,Eb as De,Fb as I,Gb as K,Ib as g,Kb as F,Lb as Oe,Ld as Re,Nb as Ge,Nd as Et,Ob as le,Pb as ue,Qb as M,Qd as xt,Rb as vt,Rd as Ct,Sb as V,Sc as Tt,T as w,Tb as de,U as b,Ua as yt,Yc as bt,Zc as It,Zd as kt,ac as Pe,ae as Dt,ba as St,be as Ot,ec as O,fc as E,l as Ce,td as X,ud as At,xb as k,ya as ke,zb as _e}from"./chunk-D2PW6GWW.js";import{$ as Ze,$b as T,A as Be,Aa as it,Ba as Te,C as G,Db as Ie,Ea as nt,Ec as gt,F as ee,G as Y,H as Q,Hd as We,Id as D,J as Ke,Ka as ae,La as ie,Ma as ne,N as U,Na as rt,Nb as ct,Q as Xe,Qa as st,Qb as re,Rb as q,Sb as N,Vc as mt,Xb as H,Xc as Ve,Ya as ot,Yb as lt,Zb as ut,_b as dt,ac as C,bb as $,bc as se,bd as ft,c as S,f as Se,fa as Je,fc as Ae,g as z,ga as te,gd as xe,h as Ye,hd as ce,ic as B,ja as et,kc as R,p as Qe,pa as f,q as j,qa as we,r as ye,sa as ve,u as qe,ua as d,ub as A,uc as ht,v as x,vb as be,vc as oe,wc as pt,xa as tt,xc as Ee,ya as at,z as He}from"./chunk-6PX2HEG6.js";import{a as p,b as v,k as l}from"./chunk-LKDXID24.js";function Gt(o,r){if(o&1&&(T(0,"mat-option",17),oe(1),C()),o&2){let u=r.$implicit;N("value",u),A(),Ee(" ",u," ")}}function Yt(o,r){if(o&1){let u=Ae();T(0,"mat-form-field",14)(1,"mat-select",16,0),B("selectionChange",function(t){ae(u);let a=R(2);return ie(a._changePageSize(t.value))}),ut(3,Gt,2,2,"mat-option",17,lt),C(),T(5,"div",18),B("click",function(){ae(u);let t=ht(2);return ie(t.open())}),C()()}if(o&2){let u=R(2);N("appearance",u._formFieldAppearance)("color",u.color),A(),N("value",u.pageSize)("disabled",u.disabled)("aria-labelledby",u._pageSizeLabelId)("panelClass",u.selectConfig.panelClass||"")("disableOptionCentering",u.selectConfig.disableOptionCentering),A(2),dt(u._displayedPageSizeOptions)}}function Qt(o,r){if(o&1&&(T(0,"div",15),oe(1),C()),o&2){let u=R(2);A(),pt(u.pageSize)}}function qt(o,r){if(o&1&&(T(0,"div",3)(1,"div",13),oe(2),C(),re(3,Yt,6,7,"mat-form-field",14)(4,Qt,2,1,"div",15),C()),o&2){let u=R();A(),q("id",u._pageSizeLabelId),A(),Ee(" ",u._intl.itemsPerPageLabel," "),A(),H(u._displayedPageSizeOptions.length>1?3:-1),A(),H(u._displayedPageSizeOptions.length<=1?4:-1)}}function Ht(o,r){if(o&1){let u=Ae();T(0,"button",19),B("click",function(){ae(u);let t=R();return ie(t.firstPage())}),ne(),T(1,"svg",8),se(2,"path",20),C()()}if(o&2){let u=R();N("matTooltip",u._intl.firstPageLabel)("matTooltipDisabled",u._previousButtonsDisabled())("matTooltipPosition","above")("disabled",u._previousButtonsDisabled()),q("aria-label",u._intl.firstPageLabel)}}function Kt(o,r){if(o&1){let u=Ae();T(0,"button",21),B("click",function(){ae(u);let t=R();return ie(t.lastPage())}),ne(),T(1,"svg",8),se(2,"path",22),C()()}if(o&2){let u=R();N("matTooltip",u._intl.lastPageLabel)("matTooltipDisabled",u._nextButtonsDisabled())("matTooltipPosition","above")("disabled",u._nextButtonsDisabled()),q("aria-label",u._intl.lastPageLabel)}}var Fe=(()=>{let r=class r{constructor(){this.changes=new Se,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(e,t,a)=>{if(a==0||t==0)return`0 of ${a}`;a=Math.max(a,0);let i=e*t,n=i<a?Math.min(i+t,a):i+t;return`${i+1} \u2013 ${n} of ${a}`}}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();function Xt(o){return o||new Fe}var Zt={provide:Fe,deps:[[new tt,new at,Fe]],useFactory:Xt},Jt=50;var ea=new ve("MAT_PAGINATOR_DEFAULT_OPTIONS"),ta=0,aa=(()=>{let r=class r{get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=Math.max(e||0,0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(e){this._length=e||0,this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=Math.max(e||0,0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(e){this._pageSizeOptions=(e||[]).map(t=>ce(t,0)),this._updateDisplayedPageSizeOptions()}constructor(e,t,a){if(this._intl=e,this._changeDetectorRef=t,this._pageSizeLabelId=`mat-paginator-page-size-label-${ta++}`,this._isInitialized=!1,this._initializedStream=new Ye(1),this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.hidePageSize=!1,this.showFirstLastButtons=!1,this.selectConfig={},this.disabled=!1,this.page=new ot,this.initialized=this._initializedStream,this._intlChanges=e.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),a){let{pageSize:i,pageSizeOptions:n,hidePageSize:s,showFirstLastButtons:c}=a;i!=null&&(this._pageSize=i),n!=null&&(this._pageSizeOptions=n),s!=null&&(this.hidePageSize=s),c!=null&&(this.showFirstLastButtons=c)}this._formFieldAppearance=(a==null?void 0:a.formFieldAppearance)||"outline"}ngOnInit(){this._isInitialized=!0,this._updateDisplayedPageSizeOptions(),this._initializedStream.next()}ngOnDestroy(){this._initializedStream.complete(),this._intlChanges.unsubscribe()}nextPage(){if(!this.hasNextPage())return;let e=this.pageIndex;this.pageIndex=this.pageIndex+1,this._emitPageEvent(e)}previousPage(){if(!this.hasPreviousPage())return;let e=this.pageIndex;this.pageIndex=this.pageIndex-1,this._emitPageEvent(e)}firstPage(){if(!this.hasPreviousPage())return;let e=this.pageIndex;this.pageIndex=0,this._emitPageEvent(e)}lastPage(){if(!this.hasNextPage())return;let e=this.pageIndex;this.pageIndex=this.getNumberOfPages()-1,this._emitPageEvent(e)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let e=this.getNumberOfPages()-1;return this.pageIndex<e&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(e){let t=this.pageIndex*this.pageSize,a=this.pageIndex;this.pageIndex=Math.floor(t/e)||0,this.pageSize=e,this._emitPageEvent(a)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._isInitialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:Jt),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((e,t)=>e-t),this._changeDetectorRef.markForCheck())}_emitPageEvent(e){this.page.emit({previousPageIndex:e,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}};r.\u0275fac=function(t){return new(t||r)(be(Fe),be(ft),be(ea,8))},r.\u0275cmp=it({type:r,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[2,"pageIndex","pageIndex",ce],length:[2,"length","length",ce],pageSize:[2,"pageSize","pageSize",ce],pageSizeOptions:"pageSizeOptions",hidePageSize:[2,"hidePageSize","hidePageSize",xe],showFirstLastButtons:[2,"showFirstLastButtons","showFirstLastButtons",xe],selectConfig:"selectConfig",disabled:[2,"disabled","disabled",xe]},outputs:{page:"page"},exportAs:["matPaginator"],standalone:!0,features:[ct,gt],decls:14,vars:14,consts:[["selectRef",""],[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-previous",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-next",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],[1,"mat-mdc-paginator-page-size-label"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],[1,"mat-mdc-paginator-page-size-value"],["hideSingleSelectionIndicator","",3,"selectionChange","value","disabled","aria-labelledby","panelClass","disableOptionCentering"],[3,"value"],[1,"mat-mdc-paginator-touch-target",3,"click"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"click","matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(t,a){t&1&&(T(0,"div",1)(1,"div",2),re(2,qt,5,4,"div",3),T(3,"div",4)(4,"div",5),oe(5),C(),re(6,Ht,3,5,"button",6),T(7,"button",7),B("click",function(){return a.previousPage()}),ne(),T(8,"svg",8),se(9,"path",9),C()(),rt(),T(10,"button",10),B("click",function(){return a.nextPage()}),ne(),T(11,"svg",8),se(12,"path",11),C()(),re(13,Kt,3,5,"button",12),C()()()),t&2&&(A(2),H(a.hidePageSize?-1:2),A(3),Ee(" ",a._intl.getRangeLabel(a.pageIndex,a.pageSize,a.length)," "),A(),H(a.showFirstLastButtons?6:-1),A(),N("matTooltip",a._intl.previousPageLabel)("matTooltipDisabled",a._previousButtonsDisabled())("matTooltipPosition","above")("disabled",a._previousButtonsDisabled()),q("aria-label",a._intl.previousPageLabel),A(3),N("matTooltip",a._intl.nextPageLabel)("matTooltipDisabled",a._nextButtonsDisabled())("matTooltipPosition","above")("disabled",a._nextButtonsDisabled()),q("aria-label",a._intl.nextPageLabel),A(3),H(a.showFirstLastButtons?13:-1))},dependencies:[kt,_t,Tt,bt,xt],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color, var(--mat-app-on-surface));background-color:var(--mat-paginator-container-background-color, var(--mat-app-surface));font-family:var(--mat-paginator-container-text-font, var(--mat-app-body-small-font));line-height:var(--mat-paginator-container-text-line-height, var(--mat-app-body-small-line-height));font-size:var(--mat-paginator-container-text-size, var(--mat-app-body-small-size));font-weight:var(--mat-paginator-container-text-weight, var(--mat-app-body-small-weight));letter-spacing:var(--mat-paginator-container-text-tracking, var(--mat-app-body-small-tracking));--mat-form-field-container-height:var(--mat-paginator-form-field-container-height);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size, var(--mat-app-body-small-size))}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color, var(--mat-app-on-surface-variant))}.mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color)}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}.cdk-high-contrast-active .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon,.cdk-high-contrast-active .mat-mdc-paginator-icon{fill:currentColor;fill:CanvasText}.cdk-high-contrast-active .mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}.mat-mdc-paginator-touch-target{display:var(--mat-paginator-touch-target-display);position:absolute;top:50%;left:50%;width:84px;height:48px;background-color:rgba(0,0,0,0);transform:translate(-50%, -50%);cursor:pointer}"],encapsulation:2,changeDetection:0});let o=r;return o})(),ka=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Te({type:r}),r.\u0275inj=we({providers:[Zt],imports:[It,Dt,Ct,aa]});let o=r;return o})();var ge="Service workers are disabled or not supported by this browser";function ia(o){return Be(()=>ye(new Error(o)))}var J=class{constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=ia(ge);else{let e=G(r,"controllerchange").pipe(x(()=>r.controller)),t=Be(()=>j(r.controller)),a=He(t,e);this.worker=a.pipe(Q(h=>!!h)),this.registration=this.worker.pipe(te(()=>r.getRegistration()));let c=G(r,"message").pipe(x(h=>h.data)).pipe(Q(h=>h&&h.type)).pipe(Ze());c.connect(),this.events=c}}postMessage(r,u){return this.worker.pipe(U(1),et(e=>{e.postMessage(p({action:r},u))})).toPromise().then(()=>{})}postMessageWithOperation(r,u,e){let t=this.waitForOperationCompleted(e),a=this.postMessage(r,u);return Promise.all([a,t]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let u;return typeof r=="string"?u=e=>e.type===r:u=e=>r.includes(e.type),this.events.pipe(Q(u))}nextEventOfType(r){return this.eventsOfType(r).pipe(U(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(Q(u=>u.nonce===r),U(1),x(u=>{if(u.result!==void 0)return u.result;throw new Error(u.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},Lt=(()=>{let r=class r{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new Se,!e.isEnabled){this.messages=Y,this.notificationClicks=Y,this.subscription=Y;return}this.messages=this.sw.eventsOfType("PUSH").pipe(x(a=>a.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(x(a=>a.data)),this.pushManager=this.sw.registration.pipe(x(a=>a.pushManager));let t=this.pushManager.pipe(te(a=>a.getSubscription()));this.subscription=ee(t,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(ge));let t={userVisibleOnly:!0},a=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(a.length));for(let n=0;n<a.length;n++)i[n]=a.charCodeAt(n);return t.applicationServerKey=i,this.pushManager.pipe(te(n=>n.subscribe(t)),U(1)).toPromise().then(n=>(this.subscriptionChanges.next(n),n))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(ge));let e=t=>{if(t===null)throw new Error("Not subscribed to push notifications.");return t.unsubscribe().then(a=>{if(!a)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(U(1),te(e)).toPromise()}decodeBase64(e){return atob(e)}};r.\u0275fac=function(t){return new(t||r)(d(J))},r.\u0275prov=f({token:r,factory:r.\u0275fac});let o=r;return o})(),Le=(()=>{let r=class r{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=Y,this.unrecoverable=Y;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ge));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ge));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}};r.\u0275fac=function(t){return new(t||r)(d(J))},r.\u0275prov=f({token:r,factory:r.\u0275fac});let o=r;return o})();var Pt=new ve("");function na(o,r,u,e){return()=>{if(!(We(e)&&"serviceWorker"in navigator&&u.enabled!==!1))return;let t=o.get(Ie),a=o.get(Ve);t.runOutsideAngular(()=>{let n=navigator.serviceWorker,s=()=>{var c;return(c=n.controller)==null?void 0:c.postMessage({action:"INITIALIZE"})};n.addEventListener("controllerchange",s),a.onDestroy(()=>{n.removeEventListener("controllerchange",s)})});let i;if(typeof u.registrationStrategy=="function")i=u.registrationStrategy();else{let[n,...s]=(u.registrationStrategy||"registerWhenStable:30000").split(":");switch(n){case"registerImmediately":i=j(null);break;case"registerWithDelay":i=Rt(+s[0]||0);break;case"registerWhenStable":i=s[0]?ee(Ft(o),Rt(+s[0])):Ft(o);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${u.registrationStrategy}`)}}t.runOutsideAngular(()=>i.pipe(U(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:u.scope}).catch(n=>console.error("Service worker registration failed with:",n))))}}function Rt(o){return j(null).pipe(Xe(o))}function Ft(o){return o.get(Ve).isStable.pipe(Q(u=>u))}function ra(o,r){return new J(We(r)&&o.enabled!==!1?navigator.serviceWorker:void 0)}var pe=class{};function sa(o,r={}){return nt([Lt,Le,{provide:Pt,useValue:o},{provide:pe,useValue:r},{provide:J,useFactory:ra,deps:[pe,$]},{provide:mt,useFactory:na,deps:[st,Pt,pe,$],multi:!0}])}var Na=(()=>{let r=class r{static register(e,t={}){return{ngModule:r,providers:[sa(e,t)]}}};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Te({type:r}),r.\u0275inj=we({providers:[Lt,Le]});let o=r;return o})();var ja=w("[Transactions] Load Transactions",b()),Ua=w("[Transactions] Load Transactions Success",b()),$a=w("[Transactions] Load Transactions Failure",b()),Ba=w("[Transactions] Create Transaction",b()),Ne=w("[Transactions] Create Transaction Success",b()),Va=w("[Transactions] Create Transaction Failure",b()),Wa=w("[Transactions] Update Transaction",b()),me=w("[Transactions] Update Transaction Success",b()),Ga=w("[Transactions] Update Transaction Failure",b()),Ya=w("[Transactions] Delete Transaction",b()),Me=w("[Transactions] Delete Transaction Success",b()),Qa=w("[Transactions] Delete Transaction Failure",b()),qa=w("[Transactions] Get Transaction",b()),Ha=w("[Transactions] Get Transaction Success",b()),Ka=w("[Transactions] Get Transaction Failure",b()),Xa=w("[Transactions] Clear Transactions");var Nt=(()=>{let r=class r{constructor(e,t){this.firestore=e,this.auth=t,this.isOnlineSubject=new z(!0),this.isOnline$=this.isOnlineSubject.asObservable()}getCurrentUserId(){var e;return((e=this.auth.currentUser)==null?void 0:e.uid)||null}isAuthenticated(){return!!this.auth.currentUser}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getCollectionRef(e){let t=this.getCurrentUserId();if(!t)throw new Error(E.AUTH.SESSION_EXPIRED);return I(this.firestore,`users/${t}/${e}`)}getDocumentRef(e,t){let a=this.getCurrentUserId();if(!a)throw new Error(E.AUTH.SESSION_EXPIRED);return g(this.firestore,`users/${a}/${e}/${t}`)}handleError(e,t){console.error(`Error in ${t}:`,e);let a=E.NETWORK.SERVER_ERROR;if(e.code)switch(e.code){case"auth/user-not-found":a=E.AUTH.USER_NOT_FOUND;break;case"auth/wrong-password":a=E.AUTH.INVALID_CREDENTIALS;break;case"auth/email-already-in-use":a=E.AUTH.EMAIL_ALREADY_EXISTS;break;case"auth/weak-password":a=E.AUTH.WEAK_PASSWORD;break;case"permission-denied":a=E.PERMISSION.ACCESS_DENIED;break;case"unavailable":a=E.NETWORK.CONNECTION_ERROR;break;default:a=e.message||E.NETWORK.SERVER_ERROR}return ye(()=>new Error(a))}validateRequiredFields(e,t){let a=t.filter(i=>!e[i]);if(a.length>0)throw new Error(`${E.VALIDATION.REQUIRED_FIELD}: ${a.join(", ")}`)}validateAmount(e){if(e<O.VALIDATION.MIN_AMOUNT||e>O.VALIDATION.MAX_AMOUNT)throw new Error(E.VALIDATION.INVALID_AMOUNT)}validateStringLength(e,t,a,i){if(e.length<t)throw new Error(`${E.VALIDATION.MIN_LENGTH.replace("{min}",t.toString())} for ${i}`);if(e.length>a)throw new Error(`${E.VALIDATION.MAX_LENGTH.replace("{max}",a.toString())} for ${i}`)}addSyncStatus(e,t=Pe.SYNCED){return v(p({},e),{syncStatus:t,lastSyncedAt:M()})}addMetadata(e,t){return v(p({},e),{createdAt:M(),updatedAt:M(),createdBy:t,updatedBy:t})}updateMetadata(e,t){return v(p({},e),{updatedAt:M(),updatedBy:t})}cacheData(e,t){try{let a={data:t,timestamp:Date.now(),expiry:Date.now()+O.OFFLINE.CACHE_EXPIRY};localStorage.setItem(e,JSON.stringify(a))}catch(a){console.error("Failed to cache data:",a)}}getCachedData(e){try{let t=localStorage.getItem(e);if(!t)return null;let a=JSON.parse(t);return Date.now()>a.expiry?(localStorage.removeItem(e),null):a.data}catch(t){return console.error("Failed to get cached data:",t),null}}clearCachedData(e){try{localStorage.removeItem(e)}catch(t){console.error("Failed to clear cached data:",t)}}debounce(e,t=O.PERFORMANCE.DEBOUNCE_DELAY){let a;return(...i)=>{clearTimeout(a),a=setTimeout(()=>e(...i),t)}}throttle(e,t=O.PERFORMANCE.THROTTLE_DELAY){let a=0;return(...i)=>{let n=Date.now();n-a>=t&&(a=n,e(...i))}}formatCurrency(e,t="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e)}formatDate(e,t="MM/dd/yyyy"){let a={year:"numeric",month:"2-digit",day:"2-digit"};return new Intl.DateTimeFormat("en-US",a).format(e)}isDataExpired(e,t=O.OFFLINE.CACHE_EXPIRY){return Date.now()-e>t}retryOperation(i){return l(this,arguments,function*(e,t=O.OFFLINE.MAX_RETRY_ATTEMPTS,a=1e3){let n;for(let s=0;s<=t;s++)try{return yield e()}catch(c){if(n=c,s===t)throw c;let h=a*Math.pow(2,s);yield new Promise(m=>setTimeout(m,h))}throw n})}};r.\u0275fac=function(t){return new(t||r)(d(P),d(k))},r.\u0275prov=f({token:r,factory:r.\u0275fac});let o=r;return o})();var Mt=(()=>{let r=class r{constructor(e,t){this.firestore=e,this.auth=t}createAccount(e,t){return new S(a=>{let i=this.generateAccountId(),n=v(p({accountId:i,userId:e},t),{createdAt:new Date,isActive:!0}),s=g(this.firestore,`users/${e}/accounts/${i}`);vt(s,n).then(()=>{a.next(i),a.complete()}).catch(c=>{a.error(c)})})}getAccounts(e){let t=I(this.firestore,`users/${e}/accounts`);return new S(a=>{Oe(t).then(i=>{let n=[];i.forEach(s=>{n.push(s.data())}),a.next(n)})})}getAccount(e,t){return new S(a=>{let i=g(this.firestore,`users/${e}/accounts/${t}`);F(i).then(n=>{n.exists()?a.next(n.data()):a.next(void 0),a.complete()}).catch(n=>{a.error(n)})})}updateAccount(e,t,a){return new S(i=>{let n=g(this.firestore,`users/${e}/accounts/${t}`),s=v(p({},a),{updatedAt:new Date});V(n,s).then(()=>{i.next(),i.complete()}).catch(c=>{i.error(c)})})}deleteAccount(e,t){return new S(a=>{let i=g(this.firestore,`users/${e}/accounts/${t}`);K(i).then(()=>{a.next(),a.complete()}).catch(n=>{a.error(n)})})}updateAccountBalanceForTransaction(e,t,a,i,n){return new S(s=>{l(this,null,function*(){try{let h=g(this.firestore,`users/${e}/accounts/${t}`),m=yield F(h);if(!m.exists()){s.error("Account not found");return}let _=m.data(),y=0;switch(a){case"create":n&&(y=n.type==="income"?n.amount:-n.amount);break;case"update":if(i&&n){let Ue=i.type==="income"?i.amount:-i.amount;y=(n.type==="income"?n.amount:-n.amount)-Ue}break;case"delete":i&&(y=i.type==="income"?-i.amount:i.amount);break}let W=(_.balance||0)+y;yield V(h,{balance:W,updatedAt:new Date}),s.next(W),s.complete()}catch(h){s.error(h)}})})}updateAccountBalanceForTransactions(e,t){return new S(a=>{l(this,null,function*(){try{let n=de(this.firestore),s=new Map;t.forEach(c=>{let h=s.get(c.accountId)||0,m=c.type==="income"?c.amount:-c.amount;s.set(c.accountId,h+m)});for(let[c,h]of s){let m=g(this.firestore,`users/${e}/accounts/${c}`),_=yield F(m);if(_.exists()){let W=(_.data().balance||0)+h;n.update(m,{balance:W,updatedAt:new Date})}}yield n.commit(),a.next(),a.complete()}catch(n){a.error(n)}})})}updateAccountBalanceForAccountTransfer(e,t,a,i){return new S(n=>{l(this,null,function*(){try{let c=de(this.firestore),h=g(this.firestore,`users/${e}/accounts/${t}`),m=g(this.firestore,`users/${e}/accounts/${a}`),[_,y]=yield Promise.all([F(h),F(m)]);if(!_.exists()||!y.exists()){n.error("One or both accounts not found");return}let W=_.data(),Ue=y.data(),$e=i.type==="income"?i.amount:-i.amount,Vt=(W.balance||0)-$e;c.update(h,{balance:Vt,updatedAt:new Date});let Wt=(Ue.balance||0)+$e;c.update(m,{balance:Wt,updatedAt:new Date}),yield c.commit(),n.next(),n.complete()}catch(c){n.error(c)}})})}generateAccountId(){return"acc_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}};r.\u0275fac=function(t){return new(t||r)(d(P),d(k))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var jt=(()=>{let r=class r extends Nt{constructor(e,t,a,i,n,s,c){super(e,t),this.dateService=a,this.store=i,this.accountsService=n,this.splitwiseService=s,this.commonSyncService=c,this.transactionsSubject=new z([])}createTransaction(e,t){return new S(a=>{let i=this.generateId(),n=v(p({},t),{id:i,date:this.dateService.toDate(t.date),syncStatus:this.commonSyncService.isCurrentlyOnline()?"synced":"pending"});l(this,null,function*(){try{if(this.commonSyncService.isCurrentlyOnline())try{let c=I(this.firestore,`users/${e}/transactions`),h=yield De(c,n);t.isSplitTransaction&&t.splitGroupId&&(yield this.createSplitTransaction(t.splitGroupId,t,h.id,e)),t.categoryId&&this.store.dispatch(yt({userId:e,categoryId:t.categoryId,budgetSpent:t.amount})),this.store.dispatch(ke({userId:e,accountId:t.accountId,transactionType:"create",newTransaction:n})),this.store.dispatch(Ne({transaction:n})),this.updateTransactionCache(e,"create",n),a.next(),a.complete()}catch(c){console.error("Failed to create transaction online:",c),yield this.addToSyncQueue("create",n),this.store.dispatch(Ne({transaction:n})),this.updateTransactionCache(e,"create",n),a.next(),a.complete()}else yield this.addToSyncQueue("create",n),this.store.dispatch(Ne({transaction:n})),this.updateTransactionCache(e,"create",n),a.next(),a.complete()}catch(c){console.error("Error in createTransaction:",c),a.error(c)}})})}updateTransaction(e,t,a){return new S(i=>{l(this,null,function*(){try{let s=v(p({},a),{updatedAt:new Date,updatedBy:e,syncStatus:this.commonSyncService.isCurrentlyOnline()?"synced":"pending"});if(this.commonSyncService.isCurrentlyOnline())try{let c=g(this.firestore,`users/${e}/transactions/${t}`);yield V(c,s),(a.amount||a.accountId)&&this.store.dispatch(ke({userId:e,accountId:a.accountId||"",transactionType:"update",oldTransaction:{id:t},newTransaction:s})),this.store.dispatch(me({transaction:p({id:t},s)})),this.updateTransactionCache(e,"update",p({id:t},s)),i.next(),i.complete()}catch(c){console.error("Failed to update transaction online:",c),yield this.addToSyncQueue("update",p({id:t},s)),this.store.dispatch(me({transaction:p({id:t},s)})),this.updateTransactionCache(e,"update",p({id:t},s)),i.next(),i.complete()}else yield this.addToSyncQueue("update",p({id:t},s)),this.store.dispatch(me({transaction:p({id:t},s)})),this.updateTransactionCache(e,"update",p({id:t},s)),i.next(),i.complete()}catch(s){i.error(s)}})})}deleteTransaction(e,t){return new S(a=>{l(this,null,function*(){try{let n=g(this.firestore,`users/${e}/transactions/${t}`),s=yield F(n),c=s.exists()?p({id:s.id},s.data()):null;if(this.commonSyncService.isCurrentlyOnline())try{yield K(n),c&&(this.store.dispatch(ke({userId:e,accountId:c.accountId,transactionType:"delete",oldTransaction:c})),c.isSplitTransaction&&(yield this.splitwiseService.deleteSplitTransaction(c.id,e))),this.store.dispatch(Me({transactionId:t})),this.updateTransactionCache(e,"delete",{id:t}),a.next(),a.complete()}catch(h){console.error("Failed to delete transaction online:",h),yield this.addToSyncQueue("delete",{id:t}),this.store.dispatch(Me({transactionId:t})),this.updateTransactionCache(e,"delete",{id:t}),a.next(),a.complete()}else yield this.addToSyncQueue("delete",{id:t}),this.store.dispatch(Me({transactionId:t})),this.updateTransactionCache(e,"delete",{id:t}),a.next(),a.complete()}catch(n){a.error(n)}})})}getTransactions(e){let t=ue(I(this.firestore,`users/${e}/transactions`),le("date","desc"));return new S(a=>{let i=Ge(t,n=>{let s=[];if(n.forEach(c=>{let h=p({id:c.id},c.data());s.push(h)}),!this.commonSyncService.isCurrentlyOnline()){let c=this.getCachedTransactions(e),h=c.map(y=>y.id),m=s.map(y=>y.id),_=c.filter(y=>y.id&&!m.includes(y.id));s.push(..._)}this.cacheTransactions(e,s),this.transactionsSubject.next(s),a.next(s)},n=>{if(console.error("Failed to fetch transactions:",n),this.commonSyncService.isCurrentlyOnline())a.next([]);else{let s=this.getCachedTransactions(e);this.transactionsSubject.next(s),a.next(s)}});return()=>i()})}getTransaction(e,t){return new S(a=>{l(this,null,function*(){try{let n=g(this.firestore,`users/${e}/transactions/${t}`),s=yield F(n);if(s.exists()){let c=p({id:s.id},s.data());a.next(c)}else a.next(void 0);a.complete()}catch(n){a.error(n)}})})}getSyncStatus(){let e=this.commonSyncService.syncStatus;return{count:e.pendingItems,hasPendingOperations:e.pendingItems>0}}forceSync(){return l(this,null,function*(){yield this.commonSyncService.manualSync()})}getRecurringTransactions(e){let t=ue(I(this.firestore,`users/${e}/transactions`),le("date","desc"));return new S(a=>{let i=Ge(t,n=>{let s=[];n.forEach(h=>{let m=p({id:h.id},h.data());s.push(m)});let c=s.filter(h=>h.isRecurring===!0);a.next(c)},n=>{console.error("Failed to fetch recurring transactions:",n),a.next([])});return()=>i()})}getDueRecurringTransactions(e){return this.getRecurringTransactions(e).pipe(x(t=>{let a=new Date;return a.setHours(0,0,0,0),t.filter(i=>{if(!i.nextOccurrence)return!1;let n=i.nextOccurrence instanceof Date?i.nextOccurrence:i.nextOccurrence.toDate();return n.setHours(0,0,0,0),n<=a})}))}processRecurringTransaction(e,t){return new S(a=>{l(this,null,function*(){try{let n=v(p({},t),{date:new Date,nextOccurrence:void 0,isRecurring:!1,recurringInterval:void 0,recurringEndDate:void 0,createdAt:new Date,updatedAt:new Date,createdBy:e,updatedBy:e,syncStatus:Pe.SYNCED,isPending:!1,lastSyncedAt:new Date});if(yield this.createTransaction(e,n).toPromise(),t.recurringInterval&&t.nextOccurrence){let s=this.calculateNextOccurrence(t.recurringInterval,t.nextOccurrence),c={nextOccurrence:s,updatedAt:new Date,updatedBy:e};t.recurringEndDate&&s>t.recurringEndDate&&(c.isRecurring=!1,c.recurringInterval=void 0,c.recurringEndDate=void 0),yield this.updateTransaction(e,t.id,c).toPromise()}a.next(),a.complete()}catch(n){console.error("Failed to process recurring transaction:",n),a.error(n)}})})}calculateNextOccurrence(e,t){let a=t instanceof Date?t:t.toDate(),i=new Date(a);switch(e){case he.DAILY:i.setDate(i.getDate()+1);break;case he.WEEKLY:i.setDate(i.getDate()+7);break;case he.MONTHLY:i.setMonth(i.getMonth()+1);break;case he.YEARLY:i.setFullYear(i.getFullYear()+1);break;default:i.setDate(i.getDate()+1)}return i}createSplitTransaction(e,t,a,i){return l(this,null,function*(){try{let n={groupId:e,originalTransactionId:a,amount:t.amount,splits:t.splits||[]};yield this.splitwiseService.createSplitTransaction(n,i).toPromise()}catch(n){console.error("Failed to create split transaction:",n)}})}addToSyncQueue(e,t){return l(this,null,function*(){let a={id:this.generateId(),type:"transaction",operation:e,data:t,maxRetries:3},i=yield this.commonSyncService.registerSyncItem(a);i.success||console.error("Failed to register transaction for sync:",i.errors)})}getCachedTransactions(e){try{let t=localStorage.getItem(`transactions-cache-${e}`);if(t)return JSON.parse(t).filter(i=>i&&i.id)}catch(t){console.error("Error loading cached transactions:",t)}return[]}cacheTransactions(e,t){try{localStorage.setItem(`transactions-cache-${e}`,JSON.stringify(t))}catch(a){console.error("Error caching transactions:",a)}}updateTransactionCache(e,t,a){try{let i=this.getCachedTransactions(e);switch(t){case"create":a&&i.push(a);break;case"update":if(a){let n=i.findIndex(s=>s.id===a.id);n!==-1&&(i[n]=a)}break;case"delete":if(a){let n=i.findIndex(s=>s.id===a.id);n!==-1&&i.splice(n,1)}break}this.cacheTransactions(e,i)}catch(i){console.error("Error updating transaction cache:",i)}}updateTransactionSyncStatus(e,t){var a;try{this.updateTransactionCache(((a=this.auth.currentUser)==null?void 0:a.uid)||"","update",{id:e,syncStatus:t,lastSyncedAt:new Date}),this.store.dispatch(me({transaction:{id:e,syncStatus:t,lastSyncedAt:new Date}})),console.log(`Transaction ${e} sync status updated to: ${t}`)}catch(i){console.error("Failed to update transaction sync status:",i)}}isFirebaseValidationError(e){var t,a;return e&&(e.code==="permission-denied"||e.code==="unavailable"||e.code==="invalid-argument"||((t=e.message)==null?void 0:t.includes("permission"))||((a=e.message)==null?void 0:a.includes("validation")))}};r.\u0275fac=function(t){return new(t||r)(d(P),d(k),d(Re),d(St),d(Mt),d(Et),d(je))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var je=(()=>{let r=class r{constructor(e,t,a,i,n,s,c,h,m,_){this.firestore=e,this.auth=t,this.ngZone=a,this.validationService=i,this.swUpdate=n,this.userService=s,this.dateService=c,this.notificationService=h,this.transactionsService=m,this.platformId=_,this.DEFAULT_EXPIRY=24*60*60*1e3,this.DEFAULT_MAX_SIZE=50*1024*1024,this.HIGH_PRIORITY_EXPIRY=7*24*60*60*1e3,this.LOW_PRIORITY_EXPIRY=60*60*1e3,this.networkStatusSubject=new z({online:!1}),this.syncStatusSubject=new z({isOnline:navigator.onLine,pendingItems:0,lastSyncTime:null,isSyncing:!1,failedItems:0,invalidItems:0}),this.networkStatus$=this.networkStatusSubject.asObservable(),this.isOnline$=this.networkStatus$.pipe(x(y=>y.online)),this.serviceWorkerRegistration=null,this.syncQueue=[],D(this.platformId)||(this.networkStatusSubject.next({online:navigator.onLine}),this.initializeServices(),this.setupServiceWorkerSyncListener())}initializeServices(){return l(this,null,function*(){yield Promise.all([this.initializeNetworkMonitoring(),this.initializeServiceWorkerUpdates(),this.initializeBackgroundSync(),this.loadSyncQueue()])})}initializeNetworkMonitoring(){if(D(this.platformId))return;let e=G(window,"online").pipe(x(()=>!0)),t=G(window,"offline").pipe(x(()=>!1));if(ee(e,t).pipe(Je(navigator.onLine)).subscribe(a=>{this.updateNetworkStatus({online:a}),this.handleNetworkChange(a)}),"connection"in navigator){let a=navigator.connection;a&&a.addEventListener("change",()=>{this.updateNetworkStatus({online:navigator.onLine,connectionType:a.effectiveType,effectiveType:a.effectiveType,downlink:a.downlink,rtt:a.rtt})})}}initializeServiceWorkerUpdates(){if(this.swUpdate.isEnabled){let e=this.isMobileDevice()?O.PWA.MOBILE_UPDATE_INTERVAL:O.PWA.DESKTOP_UPDATE_INTERVAL;setInterval(()=>{this.swUpdate.checkForUpdate()},e),this.swUpdate.versionUpdates.subscribe(t=>{console.log("Service worker update event:",t),t.type==="VERSION_READY"?(console.log("New version available, activating silently:",t),this.activateUpdateSilently()):t.type==="VERSION_INSTALLATION_FAILED"&&(console.error("Service worker installation failed:",t),this.handleUpdateFailure())})}}initializeBackgroundSync(){return l(this,null,function*(){try{if(!("serviceWorker"in navigator)||!("sync"in window)){console.warn("Background Sync API not supported");return}let e=yield navigator.serviceWorker.getRegistrations();if(this.serviceWorkerRegistration=e.find(t=>t.scope.includes("/")||t.scope.includes("/wallet/"))||null,!this.serviceWorkerRegistration){console.warn("Service worker not registered for background sync");return}console.log("Background sync initialized successfully"),this.updateSyncStatus({isOnline:navigator.onLine})}catch(e){console.error("Failed to initialize background sync:",e)}})}handleNetworkChange(e){e?(this.showOnlineNotification(),this.processSyncQueue()):this.showOfflineNotification()}showOnlineNotification(){console.log("You are back online!","Your data will sync automatically.")}showOfflineNotification(){console.log("You are offline","Changes will be saved locally and synced when you reconnect.")}activateUpdateSilently(){this.swUpdate.activateUpdate().then(()=>{console.log("Update activated successfully"),window.location.reload()}).catch(e=>{console.error("Failed to activate update:",e)})}handleUpdateFailure(){console.error("Service worker update failed")}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}get syncStatus$(){return this.syncStatusSubject.asObservable()}get syncStatus(){return this.syncStatusSubject.value}registerSyncItem(e){return l(this,null,function*(){try{let t=this.validateSyncItem(e);if(!t.isValid)return console.error("Invalid sync item data:",e.id,t.errors),this.updateSyncStatus({invalidItems:this.syncStatus.invalidItems+1}),{success:!1,errors:t.errors};let a=v(p({},e),{timestamp:Date.now(),retryCount:0,maxRetries:e.maxRetries||3});return this.syncQueue.push(a),yield this.saveSyncQueue(),this.updateSyncStatus({pendingItems:this.syncStatus.pendingItems+1}),navigator.onLine&&(yield this.processSyncQueue()),console.log("Sync item registered:",a.id),{success:!0}}catch(t){return console.error("Failed to register sync item:",t),{success:!1,errors:[t instanceof Error?t.message:"Failed to register sync item"]}}})}processSyncQueue(){return l(this,null,function*(){if(this.syncQueue.length===0)return;this.updateSyncStatus({isSyncing:!0});let e=de(this.firestore),t=[],a=[];for(let i of this.syncQueue)try{let n=this.getCurrentUserId();if(!n)continue;switch(i.type){case"transaction":yield this.processTransactionSync(i,e,n);break;case"budget":yield this.processBudgetSync(i,e,n);break;case"account":yield this.processAccountSync(i,e,n);break;case"goal":yield this.processGoalSync(i,e,n);break}t.push(i.id),i.type==="transaction"&&(yield this.updateTransactionSyncStatus(i.data.id||i.id,"synced"))}catch(n){console.error(`Failed to process sync item ${i.id}:`,n),i.retryCount++,i.retryCount>=(i.maxRetries||3)&&(a.push(i.id),i.type==="transaction"&&(yield this.updateTransactionSyncStatus(i.data.id||i.id,"failed")))}if(t.length>0)try{yield e.commit(),this.syncQueue=this.syncQueue.filter(i=>!t.includes(i.id)),yield this.saveSyncQueue(),this.updateSyncStatus({lastSyncTime:Date.now(),pendingItems:this.syncQueue.length,failedItems:a.length,isSyncing:!1}),console.log(`\u2705 Processed ${t.length} sync items`)}catch(i){console.error("Failed to commit sync operations:",i),this.updateSyncStatus({isSyncing:!1})}else this.updateSyncStatus({isSyncing:!1})})}processTransactionSync(e,t,a){return l(this,null,function*(){let i=I(this.firestore,`users/${a}/transactions`);switch(e.operation){case"create":let n=g(i);t.set(n,e.data);break;case"update":let s=g(this.firestore,`users/${a}/transactions/${e.data.id}`);t.update(s,e.data);break;case"delete":let c=g(this.firestore,`users/${a}/transactions/${e.data.id}`);t.delete(c);break}})}updateTransactionSyncStatus(e,t){return l(this,null,function*(){try{this.transactionsService.updateTransactionSyncStatus(e,t),console.log(`Transaction ${e} sync status updated to: ${t}`)}catch(a){console.error("Failed to update transaction sync status:",a)}})}processBudgetSync(e,t,a){return l(this,null,function*(){let i=I(this.firestore,`users/${a}/budgets`);switch(e.operation){case"create":let n=g(i);t.set(n,e.data);break;case"update":let s=g(this.firestore,`users/${a}/budgets/${e.data.id}`);t.update(s,e.data);break;case"delete":let c=g(this.firestore,`users/${a}/budgets/${e.data.id}`);t.delete(c);break}})}processAccountSync(e,t,a){return l(this,null,function*(){let i=I(this.firestore,`users/${a}/accounts`);switch(e.operation){case"create":let n=g(i);t.set(n,e.data);break;case"update":let s=g(this.firestore,`users/${a}/accounts/${e.data.id}`);t.update(s,e.data);break;case"delete":let c=g(this.firestore,`users/${a}/accounts/${e.data.id}`);t.delete(c);break}})}processGoalSync(e,t,a){return l(this,null,function*(){let i=I(this.firestore,`users/${a}/goals`);switch(e.operation){case"create":let n=g(i);t.set(n,e.data);break;case"update":let s=g(this.firestore,`users/${a}/goals/${e.data.id}`);t.update(s,e.data);break;case"delete":let c=g(this.firestore,`users/${a}/goals/${e.data.id}`);t.delete(c);break}})}validateSyncItem(e){let t=[];if(!e.id||!e.type||!e.data)return t.push("Missing required fields: id, type, or data"),{isValid:!1,errors:t};switch(e.type){case"transaction":let a=this.validationService.validateTransactionData(e.data);a.isValid||t.push(...a.errors);break;case"budget":let i=this.validationService.validateCommonData(e.data);i.isValid||t.push(...i.errors);break;case"account":let n=this.validationService.validateCommonData(e.data);n.isValid||t.push(...n.errors);break;case"goal":let s=this.validationService.validateCommonData(e.data);s.isValid||t.push(...s.errors);break}return{isValid:t.length===0,errors:t}}triggerBackgroundSync(e){return l(this,null,function*(){if(!this.serviceWorkerRegistration){console.warn("Service worker not available for background sync");return}try{this.updateSyncStatus({isSyncing:!0});let t=e||"sync-transactions";"sync"in this.serviceWorkerRegistration?(yield this.serviceWorkerRegistration.sync.register(t),console.log("Background sync triggered:",t)):console.warn("Background Sync is not supported in this browser."),this.updateSyncStatus({lastSyncTime:Date.now(),isSyncing:!1})}catch(t){console.error("Failed to trigger background sync:",t),this.updateSyncStatus({isSyncing:!1})}})}manualSync(){return l(this,null,function*(){console.log("Manual sync triggered"),yield this.processSyncQueue()})}getSyncStats(){return l(this,null,function*(){let e=this.syncQueue.length+this.syncStatus.failedItems+this.syncStatus.invalidItems,t=e>0?this.syncQueue.length/e*100:0;return{totalPending:this.syncQueue.length,totalFailed:this.syncStatus.failedItems,totalInvalid:this.syncStatus.invalidItems,lastSyncTime:this.syncStatus.lastSyncTime,syncSuccessRate:t}})}clearCompletedItems(){return l(this,null,function*(){try{this.updateSyncStatus({pendingItems:this.syncQueue.length,failedItems:0,invalidItems:0})}catch(e){console.error("Failed to clear completed items:",e)}})}cacheData(i,n){return l(this,arguments,function*(e,t,a={}){if(!D(this.platformId))try{let s={key:e,data:t,timestamp:Date.now(),expiry:a.expiry||this.getDefaultExpiry(a.priority),size:this.calculateSize(t),priority:a.priority||"normal"};yield this.storeInCacheStorage(e,s),yield this.storeInLocalStorage(e,s),yield this.cleanupCache()}catch(s){console.error("Failed to cache data:",s)}})}getCachedData(e){return l(this,null,function*(){if(D(this.platformId))return null;try{let t=yield this.getFromCacheStorage(e);return t||(t=yield this.getFromLocalStorage(e)),t?this.isExpired(t)?(yield this.removeCachedData(e),null):t.data:null}catch(t){return console.error("Failed to get cached data:",t),null}})}removeCachedData(e){return l(this,null,function*(){if(!D(this.platformId))try{yield Promise.all([this.removeFromCacheStorage(e),this.removeFromLocalStorage(e)])}catch(t){console.error("Failed to remove cached data:",t)}})}clearCache(){return l(this,null,function*(){if(!D(this.platformId))try{yield Promise.all([this.clearCacheStorage(),this.clearLocalStorage()])}catch(e){console.error("Failed to clear cache:",e)}})}getCacheStats(){return l(this,null,function*(){if(D(this.platformId))return{totalItems:0,totalSize:0,expiredItems:0,cacheStorageSize:0,localStorageSize:0};try{let[e,t]=yield Promise.all([this.getAllFromCacheStorage(),this.getAllFromLocalStorage()]),a=[...e,...t],i=this.deduplicateItems(a),n=i.filter(c=>this.isExpired(c)),s=i.reduce((c,h)=>c+h.size,0);return{totalItems:i.length,totalSize:s,expiredItems:n.length,cacheStorageSize:e.length,localStorageSize:t.length}}catch(e){return console.error("Failed to get cache stats:",e),{totalItems:0,totalSize:0,expiredItems:0,cacheStorageSize:0,localStorageSize:0}}})}getCurrentNetworkStatus(){return this.networkStatusSubject.value}isCurrentlyOnline(){return this.networkStatusSubject.value.online}shouldWorkOffline(){try{let t=_e().currentUser;return!t||!localStorage.getItem(`user-data-${t.uid}`)?!1:!!(localStorage.getItem("app-cache-version")||localStorage.getItem("transactions-cache")||localStorage.getItem("categories-cache"))}catch(e){return console.error("Error checking offline capability:",e),!1}}getConnectionQuality(){let e=this.networkStatusSubject.value;return e.online?e.effectiveType==="4g"?"excellent":e.effectiveType==="3g"?"good":e.effectiveType==="2g"?"poor":"unknown":"offline"}requestNotificationPermission(){return"Notification"in window?Notification.requestPermission():Promise.resolve("denied")}updateNetworkStatus(e){let t=this.networkStatusSubject.value,a=p(p({},t),e);this.networkStatusSubject.next(a)}updateSyncStatus(e){let t=this.syncStatusSubject.value,a=p(p({},t),e);this.syncStatusSubject.next(a)}getCurrentUserId(){var e;return((e=this.auth.currentUser)==null?void 0:e.uid)||null}loadSyncQueue(){return l(this,null,function*(){try{let e=yield this.getCachedData("sync-queue");e&&Array.isArray(e)?(this.syncQueue=e,this.updateSyncStatus({pendingItems:this.syncQueue.length})):(this.syncQueue=[],this.updateSyncStatus({pendingItems:0}))}catch(e){console.error("Failed to load sync queue:",e),this.syncQueue=[],this.updateSyncStatus({pendingItems:0})}})}saveSyncQueue(){return l(this,null,function*(){try{yield this.cacheData("sync-queue",this.syncQueue)}catch(e){console.error("Failed to save sync queue:",e)}})}getDefaultExpiry(e){switch(e){case"high":return this.HIGH_PRIORITY_EXPIRY;case"low":return this.LOW_PRIORITY_EXPIRY;default:return this.DEFAULT_EXPIRY}}calculateSize(e){try{let t=JSON.stringify(e);return new Blob([t]).size}catch{return 0}}isExpired(e){return e.expiry?Date.now()>e.timestamp+e.expiry:!1}cleanupCache(){return l(this,null,function*(){try{let e=yield this.getCacheStats(),t=yield this.getCacheKeys();for(let a of t)(yield this.getCachedData(a))===null&&(yield this.removeCachedData(a));if(e.totalSize>this.DEFAULT_MAX_SIZE){let i=(yield this.getAllFromCacheStorage()).filter(n=>!this.isExpired(n)).sort((n,s)=>{let c={high:3,normal:2,low:1},h=c[n.priority],m=c[s.priority];return h!==m?m-h:n.timestamp-s.timestamp});for(let n of i)if(n.priority==="low"&&(yield this.removeCachedData(n.key),(yield this.getCacheStats()).totalSize<=this.DEFAULT_MAX_SIZE*.8))break}}catch(e){console.error("Failed to cleanup cache:",e)}})}getCacheKeys(){return l(this,null,function*(){if(D(this.platformId))return[];try{let[e,t]=yield Promise.all([this.getCacheStorageKeys(),this.getLocalStorageKeys()]);return[...new Set([...e,...t])]}catch(e){return console.error("Failed to get cache keys:",e),[]}})}storeInCacheStorage(e,t){return l(this,null,function*(){if("caches"in window)try{let a=yield caches.open("money-manager-data"),i=new Response(JSON.stringify(t));yield a.put(e,i)}catch(a){console.warn("Failed to store in Cache Storage:",a)}})}storeInLocalStorage(e,t){return l(this,null,function*(){try{localStorage.setItem(e,JSON.stringify(t))}catch(a){console.warn("Failed to store in Local Storage:",a)}})}getFromCacheStorage(e){return l(this,null,function*(){if("caches"in window)try{let a=yield(yield caches.open("money-manager-data")).match(e);if(a)return yield a.json()}catch(t){console.warn("Failed to get from Cache Storage:",t)}return null})}getFromLocalStorage(e){return l(this,null,function*(){try{let t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to get from Local Storage:",t)}return null})}removeFromCacheStorage(e){return l(this,null,function*(){if("caches"in window)try{yield(yield caches.open("money-manager-data")).delete(e)}catch(t){console.warn("Failed to remove from Cache Storage:",t)}})}removeFromLocalStorage(e){return l(this,null,function*(){try{localStorage.removeItem(e)}catch(t){console.warn("Failed to remove from Local Storage:",t)}})}clearCacheStorage(){return l(this,null,function*(){if("caches"in window)try{let e=yield caches.keys();yield Promise.all(e.map(t=>caches.delete(t)))}catch(e){console.warn("Failed to clear Cache Storage:",e)}})}clearLocalStorage(){return l(this,null,function*(){try{localStorage.clear()}catch(e){console.warn("Failed to clear Local Storage:",e)}})}getAllFromCacheStorage(){return l(this,null,function*(){if("caches"in window)try{let e=yield caches.open("money-manager-data"),t=yield e.keys(),a=[];for(let i of t){let n=yield e.match(i);if(n){let s=yield n.json();a.push(s)}}return a}catch(e){console.warn("Failed to get all from Cache Storage:",e)}return[]})}getAllFromLocalStorage(){return l(this,null,function*(){try{let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(a){let i=localStorage.getItem(a);if(i)try{let n=JSON.parse(i);e.push(n)}catch{}}}return e}catch(e){return console.warn("Failed to get all from Local Storage:",e),[]}})}getCacheStorageKeys(){return l(this,null,function*(){if("caches"in window)try{return(yield(yield caches.open("money-manager-data")).keys()).map(a=>a.url)}catch(e){console.warn("Failed to get Cache Storage keys:",e)}return[]})}getLocalStorageKeys(){return l(this,null,function*(){try{let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);a&&e.push(a)}return e}catch(e){return console.warn("Failed to get Local Storage keys:",e),[]}})}deduplicateItems(e){let t=new Map;for(let a of e){let i=t.get(a.key);(!i||a.timestamp>i.timestamp)&&t.set(a.key,a)}return Array.from(t.values())}isSupported(){return"serviceWorker"in navigator&&"sync"in window}setupServiceWorkerSyncListener(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{if(e.data&&e.data.type==="SYNC_COMPLETED"){let{transactionId:t,success:a}=e.data;t&&this.transactionsService.updateTransactionSyncStatus(t,a?"synced":"failed")}})}};r.\u0275fac=function(t){return new(t||r)(d(P),d(k),d(Ie),d(At),d(Le),d(Z),d(Re),d(X),d(jt),d($))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Ri=(()=>{let r=class r{constructor(e){this.platformId=e}isClientSide(){return!D(this.platformId)}};r.\u0275fac=function(t){return new(t||r)(d($))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Bt={SESSION_TIMEOUT:30*60*1e3,INACTIVITY_TIMEOUT:60*60*1e3,MAX_LOGIN_ATTEMPTS:5,LOCKOUT_DURATION:15*60*1e3,PASSWORD_MIN_LENGTH:8,REQUIRE_EMAIL_VERIFICATION:!0,ENABLE_RATE_LIMITING:!0,SECURE_HEADERS:!0},ji=(()=>{let r=class r{constructor(e,t,a,i,n){this.router=e,this.userService=t,this.notificationService=a,this.loaderService=i,this.commonSyncService=n,this.sessionStartTime=new Map,this.startSessionMonitoring()}canActivate(e,t){return this.performSecurityCheck(e,t)}canActivateChild(e,t){return this.performSecurityCheck(e,t)}performSecurityCheck(e,t){this.loaderService.show();let a=_e(),i=a.currentUser;return i?(this.backgroundSecurityCheck(e,t,i),j(!0)):new S(n=>{let s=wt(a,c=>{s(),c?(this.backgroundSecurityCheck(e,t,c),n.next(!0),this.loaderService.hide()):this.handleUnauthenticatedUser(t).then(()=>{this.loaderService.hide(),n.next(!1)})})}).pipe(qe(1e4),Ke(n=>(console.error("[AuthGuard] Timeout or error:",n),this.router.navigate(["/sign-in"],{queryParams:{error:"auth_timeout",redirect:t.url}}),j(!1))))}backgroundSecurityCheck(e,t,a){setTimeout(()=>l(this,null,function*(){try{if(this.sessionStartTime.has(a.uid)||this.updateSessionTimestamp(a.uid),this.isSessionExpired(a.uid)){yield this.handleSessionExpired(a,t);return}let i=!this.commonSyncService.isCurrentlyOnline(),n;if(i?(n=this.userService.getCachedUserData(a.uid),console.log("[AuthGuard] Offline mode - using cached user data:",n?"found":"not found")):n=yield this.userService.getCurrentUser(),!n)if(i){console.warn("[AuthGuard] Offline mode - no cached user data available, allowing access"),this.updateSessionTimestamp(a.uid);return}else{yield this.handleInvalidUserData(a,t);return}if(!(yield this.checkRoutePermissions(e,n,a))){yield this.handleInsufficientPermissions(n,t);return}this.updateSessionTimestamp(a.uid)}catch(i){if(console.error("[AuthGuard] Background error:",i),!this.commonSyncService.isCurrentlyOnline()){console.warn("[AuthGuard] Offline mode - error occurred, allowing access for offline use"),this.updateSessionTimestamp(a.uid);return}yield this.handleSecurityError(i,t)}finally{this.loaderService.hide()}}),0)}checkRoutePermissions(e,t,a){return l(this,null,function*(){var n;let i=e.data;return i!=null&&i.requireEmailVerification&&!a.emailVerified?(console.warn("[AuthGuard] Email not verified"),!1):((n=i==null?void 0:i.roles)==null?void 0:n.length)>0&&!i.roles.includes(t.role)?(console.warn("[AuthGuard] Insufficient role:",t.role),!1):i!=null&&i.requireTwoFactor&&!this.hasTwoFactorEnabled(t)?(console.warn("[AuthGuard] Two-factor required"),!1):!0})}isSessionExpired(e){let t=this.sessionStartTime.get(e),a=Date.now();return!!t&&a-t>Bt.SESSION_TIMEOUT}updateSessionTimestamp(e){this.sessionStartTime.set(e,Date.now())}handleUnauthenticatedUser(e){return l(this,null,function*(){this.router.navigate(["/sign-in"],{queryParams:{session:"expired",redirect:e.url}})})}handleSessionExpired(e,t){return l(this,null,function*(){this.sessionStartTime.delete(e.uid),this.userService.clearCachedUserData(),yield this.userService.signOut(),this.router.navigate(["/sign-in"],{queryParams:{session:"expired",redirect:t.url,reason:"timeout"}})})}handleInvalidUserData(e,t){return l(this,null,function*(){this.userService.clearCachedUserData(),yield this.userService.signOut(),this.router.navigate(["/sign-in"],{queryParams:{error:"invalid_user_data",redirect:t.url}})})}handleInsufficientPermissions(e,t){return l(this,null,function*(){this.notificationService.error("Access Denied: You do not have permission to access this page."),this.router.navigate(["/dashboard"],{queryParams:{error:"insufficient_permissions",requestedRoute:t.url}})})}handleSecurityError(e,t){return l(this,null,function*(){this.router.navigate(["/sign-in"],{queryParams:{error:"security_error",redirect:t.url,message:e.message||"Unknown error"}})})}startSessionMonitoring(){let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{this.handleInactivity()},Bt.INACTIVITY_TIMEOUT)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(a=>{document.addEventListener(a,t,!0)}),t()}handleInactivity(){let e=this.userService.getUser();e&&(console.log("[AuthGuard] Inactivity detected. Logging out user:",e.uid),this.userService.signOut())}hasTwoFactorEnabled(e){return!1}};r.\u0275fac=function(t){return new(t||r)(d(Ce),d(Z),d(X),d(Ot),d(je))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Vi=(()=>{let r=class r{constructor(e,t,a,i){this.auth=e,this.router=t,this.notificationService=a,this.userService=i}canActivate(e,t){return Qe(this.checkAdminAccess())}checkAdminAccess(){return l(this,null,function*(){try{return(yield this.auth.currentUser)?(yield this.isUserAdmin())?!0:(this.notificationService.error("Admin access required"),this.router.navigate(["/dashboard"]),!1):(this.notificationService.error("Authentication required"),this.router.navigate(["/sign-in"]),!1)}catch(e){return console.error("Error checking admin access:",e),this.notificationService.error("Failed to verify admin access"),this.router.navigate(["/dashboard"]),!1}})}isUserAdmin(){return l(this,null,function*(){return this.userService.isAdmin})}};r.\u0275fac=function(t){return new(t||r)(d(k),d(Ce),d(X),d(Z))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Qi=(()=>{let r=class r{constructor(e,t){this.firestore=e,this.auth=t}submitFeedback(e){return l(this,null,function*(){var t;try{let a=v(p({},e),{userId:((t=this.auth.currentUser)==null?void 0:t.uid)||"anonymous",timestamp:M(),status:"pending",userAgent:navigator.userAgent,appVersion:"1.0.0"}),i=I(this.firestore,"feedback"),n=yield De(i,a);console.log("Feedback submitted successfully:",n.id)}catch(a){throw console.error("Error submitting feedback:",a),a}})}getCategoryLabel(e){return{bug:"Bug Report",feature:"Feature Request",improvement:"Improvement Suggestion",general:"General Feedback",support:"Support Request"}[e]||e}getAllFeedback(){return l(this,null,function*(){try{let e=I(this.firestore,"feedback"),t=ue(e,le("timestamp","desc")),a=yield Oe(t),i=[];return a.forEach(n=>{let s=n.data();i.push(v(p({},s),{id:n.id}))}),i}catch(e){throw console.error("Error fetching feedback:",e),e}})}updateFeedbackStatus(e,t){return l(this,null,function*(){try{let a=g(this.firestore,"feedback",e);yield V(a,{status:t,updatedAt:M()})}catch(a){throw console.error("Error updating feedback status:",a),a}})}deleteFeedback(e){return l(this,null,function*(){try{let t=g(this.firestore,"feedback",e);yield K(t)}catch(t){throw console.error("Error deleting feedback:",t),t}})}};r.\u0275fac=function(t){return new(t||r)(d(P),d(k))},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();export{ja as a,Ua as b,$a as c,Ba as d,Ne as e,Va as f,Wa as g,me as h,Ga as i,Ya as j,Me as k,Qa as l,qa as m,Ha as n,Ka as o,Xa as p,Mt as q,Le as r,Na as s,je as t,jt as u,Ri as v,ji as w,Vi as x,aa as y,ka as z,Qi as A};
